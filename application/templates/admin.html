{% extends "base.html" %}
{% block scripts %}
    <script src="{{ url_for('static', filename='admin.js') }}" type="text/javascript"></script>
{% endblock %}
{% block stylesheet %}
    <style>
        .sortKey {
            cursor: pointer;
            text-decoration: underline;
        }
    </style>
{% endblock %}
{% block body %}

    <div class="row">
        <div class="col-md-6">
            <div class="card border-0 shadow" id="add_psy_card">
                <div class="card-body">
                    <form method="post" action="{{ url_for('add_psy') }}">

                        <h5 class="card-title">Добавить психолога</h5>
                        <div class="form-group">
                            <label for="loginField">Логин</label>
                            <input class="form-control" id="loginField" type="text" name="login" required>
                        </div>
                        <div class="form-group">
                            <label for="passwordField">Пароль</label>
                            <input class="form-control" id="passwordField" type="text" value="{{ pas }}" name="password"
                                   required>
                        </div>

                        <div class="form-group">
                            <label for="IdField">Идентификатор</label>
                            <input class="form-control" id="IdField" type="text" name="ident" required>
                        </div>

                        <div class="form-group col-4 px-0">
                            <label for="countField">Кол-во</label>
                            <input class="form-control" id="countField" type="number" name="count" required>
                        </div>

                        <div class="form-group">
                            <div class="custom-control custom-checkbox mr-sm-2">
                                <input type="checkbox" class="custom-control-input" id="test1" value="1" name="t1"
                                       checked>
                                <label class="custom-control-label" for="test1">Тест 1</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="custom-control custom-checkbox mr-sm-2">
                                <input type="checkbox" class="custom-control-input" id="test2" value="2" name="t2"
                                       disabled>
                                <label class="custom-control-label" for="test2">Тест 2</label>
                            </div>
                        </div>

                        <div class="form-group">
                            <input type="submit" class="btn btn-primary" value="Добавить психолога">
                        </div>
                    </form>
                </div>
            </div>

        </div>
        <div class="col-md-6">
            <div class="card border-0 shadow mt-md-0 mt-2">
                <div class="card-body">
                    <h5 class="card-title">Полная статистика</h5>
                    {% include 'stats.html' %}
                </div>
            </div>
        </div>
    </div>

    {% if msg %}
        <span style="color: #ffffff; background-color: rgb(170, 1, 1);">{{ msg }}</span>
    {% endif %}

    <h3 class="display-4 mt-5">Список психологов</h3>
    <input type="button" class="btn btn-primary" value="Показать" onclick="getPsyList()">

    <div class="table-responsive">
        <table class="table text-center" id="psyTable">
            <thead>
            <tr>
                <th class="sortKey" onclick="sortPsy('ident')">ID</th>
                <th class="sortKey" onclick="sortPsy('login')">Логин</th>
                <th>Пароль</th>
                <th class="sortKey" onclick="sortPsy('count')">Доступно</th>
                <th>Статистика</th>
                <th>Тесты</th>
                <th class="sortKey" onclick="sortPsy('create_date')">Дата создания</th>
                <th class="sortKey" onclick="sortPsy('pre_del')">Удалится</th>
                <th></th>
            </tr>

            </thead>
        {#
            {% for psy in psys %}
                <tr>
                    <td>{{ psy['ident'] }}</td>
                    <td>{{ psy['login'] }}</td>
                    <td>{{ dec(psy['pas']) }}</td>
                    <td>{{ psy['count'] }}</td>
                    <td>
                        <span class="badge badge-light badge-pill" title="Количество испытуемых">{{ psy['counters'].get('whole', 0) }}</span>
                        <span class="badge badge-secondary badge-pill" title="Еще не протестировано">{{ psy['counters'].get('not_yet', 0) }}</span>
                        <span class="badge badge-success badge-pill" title="Вне групп риска">{{ psy['counters'].get('clear', 0) }}</span>
                        <span class="badge badge-danger badge-pill" title="В группах риска">{{ psy['counters'].get('danger', 0) }}</span>
                        {% if psy['counters'].get('msg') %}
                            <span class="badge badge-warning badge-pill" title="Сообщения об удалении">{{ psy['counters'].get('msg', 0) }}</span>
                        {% endif %}
                    </td>
                    <td>{{ " ".join(psy['tests']) }}</td>
                    <td>{{ t2st(psy['create_date']) }}</td>
                    {% if psy['pre_del'] %}
                        <td>{{ t2st(psy['pre_del']) }}</td>
                    {% else %}
                        <td>-</td>
                    {% endif %}
                    <td>
                        <a class="btn btn-primary" href="{{ url_for('psy_info', login=psy['login']) }}">Подробнее</a>
                    </td>
                </tr>
            {% endfor %}
            #}
        </table>
    </div>
{% endblock %}
